
Этот микросервис имеет три Endpoint-а:
/api/v1/oauth2/registration   - регистрация нового пользователя
/api/v1/oauth2/login          - получения token пользователя по логин (username или email) и пароль
/api/v1/oauth2/refresh-token  - URL для обновления token, если он expired

---------
Собираем Docker-образ
В корне проекта:
# docker build -t oauth2-service:latest .
Проверить (сборку):
# docker images | grep oauth2-service

Запускаем контейнер:
Простой запуск (без БД)
# docker run -p 8087:8087 --name oauth2-service oauth2-service:latest

Подключение к PostgreSQL (реальный сценарий):
application.yml (localhost не работает внутри контейнера — нужно имя контейнера БД)
spring:
  r2dbc:
    url: r2dbc:postgresql://my-postgres:5432/ms_oauth2
    username: admin
    password: admin
  flyway:
      enabled: true
      url: jdbc:postgresql://my-postgres:5432/ms_oauth2
      user: admin
      password: admin
В этом случае нужно запускать контейнер с указанием сети, в которой находится контейнер с PostgreSQL.

Проверка сервиса:
curl http://localhost:8087/actuator/health
или
curl -X POST http://localhost:8087/api/v1/oauth2/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"qwerty"}'

---------
Для запуска этого микросервиса используем команду:
# docker run --env-file .env -p 8087:8087 oauth2-service

Отдельно поднимается докер контейнер с PostgreSQL базой данных.
Запускается Docker container c PostgreSQL 12 (localhost:5432)
Создается база данных ms_oauth2 с пользователем admin (пароль: admin)
// Postgresql в docker, run command:
# docker run --name my-postgres  -e POSTGRES_USER=admin  -e POSTGRES_PASSWORD=admin  -e POSTGRES_DB=ms_oauth2  -p 5432:5432  -d postgres:12
или просто запустить созданный контейнер:
# docker start my-postgres

# docker ps               - проверить запущенные контейнеры
# docker ps -a            - посмотреть все контейнеры (включая остановленные)
# docker stop my-postgres - остановить контейнер
# docker rm my-postgres   - удалить контейнер
# docker logs my-postgres - посмотреть логи контейнера
# docker images           - посмотреть образы
# docker rmi <image_id>   - удалить образ по ID
# docker exec -it my-postgres bash  - зайти в контейнер

---------
Для переноса докер контейнерана другой компьютер:
# docker commit my-postgres my-postgres-image             - создать образ из контейнера
# docker save -o my-postgres-image.tar my-postgres-image  - сохранить образ в файл

# docker load -i my-postgres-image.tar                    - загрузить образ из файла на другом компьютере
# docker run --name my-postgres -p 5432:5432 -d my-postgres-image  - запустить контейнер из образа
Минус: данные, хранящиеся во внешних volume, не попадут, только данные внутри контейнера.
Или перенести данные как бекапы баз данных.

---------
Для добавления БД в докер контейнер my-postgres:
# docker exec -it my-postgres bash   - зайти в контейнер
# psql -U admin -d postgres          - подключиться к psql под пользователем admin к базе postgres
CREATE DATABASE ms_oauth2;
\l                -- список баз данных
\c ms_oauth2;     -- подключиться к базе
\d                -- список таблиц
\q                -- выйти из psql

